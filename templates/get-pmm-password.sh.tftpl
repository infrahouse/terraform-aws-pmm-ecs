#!/bin/bash
set -euo pipefail

# Retrieve PMM admin password from AWS Secrets Manager
ADMIN_PASSWORD=$(aws secretsmanager get-secret-value \
  --secret-id ${admin_password} \
  --region ${aws_region} \
  --query SecretString \
  --output text)

# Write to env file (Docker --env-file doesn't need quotes)
cat > /etc/pmm-server.env <<EOF
ADMIN_PASSWORD=$ADMIN_PASSWORD
EOF

chmod 600 /etc/pmm-server.env